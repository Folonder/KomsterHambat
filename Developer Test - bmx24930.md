# Взломать Komster Hambat

Есть игра-кликалка Komster Hambat (все совпадения случайны!), где пользователю предлагается просто кликать в объект на экране (тапать), в надежде что он в будущем получит/выиграет что-то материальное, причём шансы тем выше, чем больше пользователь накликает.

Вы "случайно" обнаружили, что вся логика выполняется на сервере игры, куда пользовательский интерфейс отправляет информацию о количестве сделанных пользователем кликов, таким образом кликать по экрану совсем необязательно, достаточно лишь правильно отправлять информацию на сервер (примеры запросов и ответов находятся в Приложениях).

Логика игры (то что удалось выяснить):
* Ожидается, что пользователь регулярно запускает (открывает) игру, кликает по экрану сколько-то раз, радуется увеличившемуся балансу и закрывает игру (делает перерыв);
* При запуске игра делает запрос `sync` для получения информации о текущем пользователе;
* Авторизационный токен был получен при самом первом запуске, теперь же его просто надо указывать без изменений;
* Клики по экрану считаются/накапливаются на стороне пользователя, а потом (когда 3-5 секунд пользователь не кликает по экрану) отправляются на сервер запросом `tap`;
* Сервер "проверяет математику" (см. ниже), чтобы нельзя было сразу "нарисовать" себе 100500 миллионов очков;
* Один клик приносит `earnPerTap` очков;
* Каждый клик потребляет энергию, запас которой ограничен;
* Текущий остаток энергии это `availableTaps`;
* Каждый клик потребляет `earnPerTap` энергии, нельзя кликать если энергии недостаточно;
* Энергия самостоятельно восполняется со скоростью `tapsRecoverPerSec` в секунду;
* Энергия восполняется до значения `maxTaps`, потом восполнение останавливается. После клика (траты энергии) она снова начинает восполняться до этого предела.
* Суммарные очки пользователя находятся в поле `balanceCoins`;
* Поле `lastSyncUpdate` хранит датувремя последнего изменения (засчитанных кликов);


## Задание 1

Ваша задача - написать "отправлятель" фиктивной информации о кликах, т.е. по сути реализовать автокликер для игры.

Решение должно быть представлено либо в виде репо на github, либо в zip-архиве git-репо с локального диска.

Обязательные требования:

1. C#, .NET 8, консольное приложение;
2. Автономная работа (запустил, свернул и оно само работает/кликает в фоне);
3. Однократный запуск (т.е. все ожидания/sleep - внутри приложения, не должно быть требования регулярных запусков через внешний cron);
4. Если "случайно" закрыл приложение "крестиком" (Alt+F4) - его должно быть достаточно просто снова запустить, никакие данные при этом не должны потеряться и т.п.
5. При работе 24х7 должно набираться максимально возможное за сутки количество баллов, т.е. "потери от неактивности" должны быть минимальные;
6. Нельзя "задалбливать" сервер игры некорректными запросами, иначе он может забанить пользователя;
7. Информация на экране (stdout) должна давать представление о том "как идут дела, все ли ОК";


Опциональные требования:

1. Действия автокликера (с точки зрения сервера игры) должны быть похожи на действия живого человека, чтобы минимизировать риск обнаружения статистическими методами анализа;
2. Чем меньше будет использоваться сторонних nuget-пакетов и сервисов - тем лучше;
3. Чем меньше потребляется системных ресурсов - тем лучше (автокликер все же работает в фоне и не должен мешать пользователю);
4. Сервер иногда может падать (возвращать 500-е ошибки) - это не должно "вызывать панику" у автокликера, должны быть повторы (retry); 


## Задание 2

Представьте что вы - один из разработчиков этой игры, и вы случайно обнаружили на гитхабе репозиторий с решением Задания 1.

Какие изменения в игру (в архитектуру серверной части) вы бы предложили внести, чтобы усложнить написание следующей версии автокликера?

Ответ ожидается в виде обычного текста/документа.


## Приложение 1: Запрос на получение информации об аккаунте

Запрос:
```
POST https://api.komsterhambat.io/clicker/sync HTTP/1.1
Host: api.komsterhambat.io
Content-Length: 0
authorization: Bearer VGhpcyBpcyBhIHNhbXBsZSBzdHJpbmcsIG5vdGhpbmcgaW50ZXJlc3RpbmcgaGVyZQ==
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/536.37 (KHTML, like Gecko) Chrome/162.0.0.0 Safari/577.96 Edg/162.0.0.0
Accept: */*
Origin: https://komsterhambat.io
Referer: https://komsterhambat.io/
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
```

Ответ сервера (body, упрощённое):
```
{
  "clickerUser": {
    "id": "1234567890",
    "balanceCoins": 110716598.49949667,
    "availableTaps": 2359,
    "lastSyncUpdate": 1719588467,
    "maxTaps": 7000,
    "earnPerTap": 10,
    "tapsRecoverPerSec": 3
  }
}
```


## Приложение 2: Запрос зачисление кликов

Запрос:

```
POST https://api.komsterhambat.io/clicker/tap HTTP/1.1
Host: api.komsterhambat.io
Content-Length: 55
accept: application/json
content-type: application/json
authorization: Bearer VGhpcyBpcyBhIHNhbXBsZSBzdHJpbmcsIG5vdGhpbmcgaW50ZXJlc3RpbmcgaGVyZQ==
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/536.37 (KHTML, like Gecko) Chrome/162.0.0.0 Safari/577.96 Edg/162.0.0.0
Origin: https://komsterhambat.io
Referer: https://komsterhambat.io/
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9

{"count":5,"availableTaps":1225,"timestamp":1719588990}
```

При этом `count` это именно количество кликов (штук), а не очки которые они приносят (т.е. без умножения на `earnPerTap`).

Сервер сверяет переданное `availableTaps` с рассчитанным на сервере. Небольшие отклонения (+-50) игнорируются, но большие обрабатываются так: если клиент прислал значение больше ожидаемого, то сервер отвечает 400-й ошибкой; если клиент прислал меньше ожидаемого - сервере сбрасывает/уменьшает свое значение до указанного (т.е. нельзя "накинуть" себе энергии, а если "случайно списать лишнее" - сервер спишет тоже).

Структура ответа сервера идентична ответу на `/clicker/sync`.